!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dashboardwidgets=t():(e.coreapps=e.coreapps||{},e.coreapps.dashboardwidgets=t())}(this,function(){return webpackJsonpcoreapps__name_([0],{137:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(4),u=a(l),c=n(159);t.default=o.default.module("openmrs-contrib-dashboardwidgets.appointments",[s.default,u.default,s.default]).component(c.BahmniAppointmentsComponent.selector,c.BahmniAppointmentsComponent).name},138:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(162);t.default=o.default.module("openmrs-contrib-dashboardwidgets.dataintegrityviolations",[s.default]).component(l.DatatIntegrityViolationsComponent.selector,l.DatatIntegrityViolationsComponent).name},139:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(4),u=a(l),c=n(169);t.default=o.default.module("openmrs-contrib-dashboardwidgets.latestobsforconceptlist",[s.default,u.default]).component(c.LatestObsForConceptListComponent.selector,c.LatestObsForConceptListComponent).name},140:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(4),u=a(l),c=n(171);t.default=o.default.module("openmrs-contrib-dashboardwidgets.obsacrossencounters",[s.default,s.default,u.default]).component(c.ObsAcrossEncountersComponent.selector,c.ObsAcrossEncountersComponent).name},141:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(147),u=a(l),c=n(4),d=a(c),p=n(173);t.default=o.default.module("openmrs-contrib-dashboardwidgets.obsgraph",[s.default,s.default,d.default,u.default]).component(p.ObsGraphComponent.selector,p.ObsGraphComponent).config(["ChartJsProvider",function(e){e.setOptions({chartColors:["#00463f","#bf4f44","#567fad"],spanGaps:!0,elements:{line:{tension:0}}})}]).name},142:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(4),u=a(l),c=n(175);t.default=o.default.module("openmrs-contrib-dashboardwidgets.programs",[s.default,s.default,u.default]).component(c.ProgramsComponent.selector,c.ProgramsComponent).name},143:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(177);t.default=o.default.module("openmrs-contrib-dashboardwidgets.programstatistics",[s.default,s.default]).component(l.ProgramStatisticsComponent.selector,l.ProgramStatisticsComponent).name},144:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(166),u=a(l),c=n(4),d=a(c),p=n(179);t.default=o.default.module("openmrs-contrib-dashboardwidgets.programstatus",[s.default,u.default,s.default,d.default]).component(p.ProgramStatusComponent.selector,p.ProgramStatusComponent).name},145:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(154),u=a(l),c=n(181);t.default=o.default.module("openmrs-contrib-dashboardwidgets.relationships",[s.default,u.default,s.default]).component(c.RelationshipsComponent.selector,c.RelationshipsComponent).name},146:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i),l=n(4),u=a(l),c=n(183);t.default=o.default.module("openmrs-contrib-dashboardwidgets.visitbyencountertype",[s.default,u.default,s.default]).component(c.VisitByEncounterTypeComponent.selector,c.VisitByEncounterTypeComponent).name},159:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BahmniAppointmentsComponent=void 0;var r=n(160),o=a(r),i=n(251),s=a(i);t.BahmniAppointmentsComponent={template:s.default,controller:o.default,selector:"bahmniappointments",bindings:{config:"<"}}},160:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(){function e(t,n,r){"ngInject";a(this,e),Object.assign(this,{openmrsRest:t,widgetsCommons:n,openmrsTranslate:r})}return e.$inject=["openmrsRest","widgetsCommons","openmrsTranslate"],r(e,[{key:"$onInit",value:function(){var e=this;this.appointments=[],this.serverUrl="",this.startDate=new Date,this.openmrsRest.setBaseAppPath("/coreapps"),this.openmrsRest.getServerUrl().then(function(t){e.serverUrl=t});var t={url:"/appointments/search",actions:{save:{method:"POST",isArray:!0}}};this.openmrsRest.create(t,{patientUuid:this.config.patientUuid,startDate:this.startDate,limit:this.config.maxRecords}).then(function(t){e.getAppointments(t)})}},{key:"getAppointments",value:function(e){var t=this;e.length>0&&angular.forEach(e,function(e){var n={date:e.startDateTime,startTime:e.startDateTime,endTime:e.endDateTime,ServiceType:e.service.name};t.appointments.push(n)})}}]),e}();t.default=o},161:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(){a(this,e)}return r(e,[{key:"dateToDaysAgoMessage",value:function(e){var t=this.dateToDaysAgo(e);return 0==t?"today":1==t?t+" day ago":t+" days ago"}},{key:"daysSinceDate",value:function(e){var t=0;if(null!==e){var n=new Date(e).setHours(0,0,0,0),a=(new Date).setHours(0,0,0,0),r=Math.floor((a-n)/1e3);t=Math.floor(r/86400)}return t}},{key:"dateToDaysAgo",value:function(e){var t=new Date(e).getTime(),n=Math.floor(((new Date).getTime()-t)/1e3),a=Math.floor(n/86400),r=0;return a>0&&(r=a),r}},{key:"maxAgeToDays",value:function(e){if(void 0!==e){var t=0,n=e.split(" "),a=!0,r=!1,o=void 0;try{for(var i,s=n[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;l.includes("d")&&(t+=parseInt(l.replace("d",""))),l.includes("w")&&(t+=7*parseInt(l.replace("w",""))),l.includes("m")&&(t+=30*parseInt(l.replace("m",""))),l.includes("y")&&(t+=365*parseInt(l.replace("y","")))}}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}return t}}},{key:"maxAgeToDate",value:function(e){if(void 0===e)return null;var t=new Date;if(-1!==e.indexOf("d"))e=e.replace("d",""),t.setDate(t.getDate()-parseInt(e));else if(-1!==e.indexOf("w"))e=e.replace("w",""),t.setDate(t.getDate()-7*parseInt(e));else if(-1!==e.indexOf("m"))e=e.replace("m",""),t.setMonth(t.getMonth()-parseInt(e));else{if(-1===e.indexOf("y"))return null;e=e.replace("y",""),t.setFullYear(t.getFullYear()-parseInt(e))}return t}},{key:"getConceptName",value:function(e,t,n){var a=e.names.filter(function(e){return!e.voided&&e.locale===n}),r=a.filter(function(e){return"FULLY_SPECIFIED"===e.conceptNameType})[0],o=a.filter(function(e){return"SHORT"===e.conceptNameType})[0],i=e.names.filter(function(e){return!e.voided&&"en"===e.locale&&"SHORT"===e.conceptNameType})[0],s=a.filter(function(e){return e.localePreferred})[0],l=void 0;return"FSN"===t?l=r||s:"shortName"===t?l=o||i:"preferred"===t&&(l=s),l?l.name:e.display}},{key:"hasDatatypeDateOrSimilar",value:function(e){return e.datatype&&["8d4a505e-c2cc-11de-8d13-0010c6dffd0f","8d4a591e-c2cc-11de-8d13-0010c6dffd0f","8d4a5af4-c2cc-11de-8d13-0010c6dffd0f"].includes(e.datatype.uuid)}},{key:"hasDatatypeCoded",value:function(e){return e.datatype&&"8d4a48b6-c2cc-11de-8d13-0010c6dffd0f"===e.datatype.uuid}},{key:"isDrug",value:function(e){return Boolean(e.concept)}},{key:"formatDate",value:function(e,t,n){try{return i.default.locale(n),(0,i.default)(e).format(t)}catch(t){return(0,i.default)(e).format("DD.MMM.YYYY")}}},{key:"formatDateTime",value:function(e,t,n){try{return i.default.locale(n),(0,i.default)(e).format(t)}catch(t){return(0,i.default)(e).format("DD.MMM.YYYY HH:mm")}}},{key:"isSystemDeveloper",value:function(e){return e.roles.some(function(e){return"System Developer"===e.name})}}]),e}();t.default=s},162:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DatatIntegrityViolationsComponent=void 0;var r=n(163),o=a(r),i=n(252),s=a(i);t.DatatIntegrityViolationsComponent={template:s.default,controller:o.default,selector:"dataintegrityviolations",bindings:{config:"<"}}},163:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(){function e(t){"ngInject";a(this,e),Object.assign(this,{openmrsRest:t})}return e.$inject=["openmrsRest"],r(e,[{key:"$onInit",value:function(){var e=this;this.dataViolations=[],this.openmrsRest.setBaseAppPath("/coreapps"),this.openmrsRest.getServerUrl().then(function(t){e.serverUrl=t}),angular.isUndefined(this.config.maxResults)&&(this.config.maxResults=6),this.openmrsRest.list("dataintegrity/integrityresults",{patient:this.config.patientUuid,v:"full",limit:this.config.maxResults}).then(function(t){for(var n=0;n<t.results.length;n++)e.dataViolations.push(t.results[n])})}}]),e}();t.default=o},164:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DatepickerComponent=void 0;var r=n(165),o=a(r),i=n(253),s=a(i);t.DatepickerComponent={template:s.default,controller:o.default,selector:"openmrsDatepicker",bindings:{ngModel:"=",format:"@",language:"@",startDate:"<",endDate:"<",clearBtn:"<"}}},165:function(e,t,n){"use strict";(function(e){function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),i=(function(e){e&&e.__esModule}(o),function(){function t(e,n,r,o,i,s){"ngInject";a(this,t),Object.assign(this,{$document:e,$element:n,$scope:r,$filter:o,$timeout:i,openmrsTranslate:s})}return t.$inject=["$document","$element","$scope","$filter","$timeout","openmrsTranslate"],r(t,[{key:"$onInit",value:function(){var t=this;this.$document.ready(function(){t.openmrsTranslate.getLanguage().then(function(n){e(t.$element).datepicker({format:t.convertDateFormat(t.format),autoclose:!0,container:"html",language:n,clearBtn:t.clearBtn}).on("changeDate",function(e){null!=e.date?null!=t.ngModel&&t.stripTime(t.ngModel).getTime()===t.stripTime(e.date).getTime()||t.$scope.$apply(function(){t.ngModel=t.stripTime(e.date)}):null!=t.ngModel&&t.$timeout(function(){t.ngModel=null})}),t.$scope.$watch(function(){return t.ngModel},function(e){t.updateDates()}),t.$scope.$watch(function(){return t.startDate},function(e){t.updateDates()}),t.$scope.$watch(function(){return t.endDate},function(e){t.updateDates()})})})}},{key:"updateDates",value:function(){e(this.$element).datepicker("setStartDate",this.stripTime(this.startDate)),e(this.$element).datepicker("setEndDate",this.stripTime(this.endDate)),e(this.$element).datepicker("setDate",this.stripTime(this.ngModel))}},{key:"stripTime",value:function(e){return null==e?null:new Date(e.getFullYear(),e.getMonth(),e.getDate())}},{key:"convertDateFormat",value:function(e){var t={MMMM:"MM",MMM:"M",MM:"mm",M:"m",yyyy:"yy",yy:"y",EEEE:"DD",EEE:"D"},n="";for(var a in t)n=n+a+"|";return n=n.substring(0,n.length-1),e=e.replace(new RegExp(n,"g"),function(e){return t[e]?t[e]:e})}}]),t}());t.default=i}).call(t,n(1))},166:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(3),s=a(i);n(185),n(264),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(167);var l=n(164);t.default=o.default.module("openmrs-contrib-dashboardwidgets.datepicker",[s.default]).component(l.DatepickerComponent.selector,l.DatepickerComponent).name},167:function(e,t,n){"use strict";(function(e){!function(e){e.fn.datepicker.dates.ht={days:["dimanch","lendi","madi","mèkredi","jedi","vandredi","samdi"],daysShort:["dim","len","mad","mek","jed","van","sam"],daysMin:["d","l","ma","me","j","v","s","d"],months:["janvye","fevriye","mas","avril","me","jen","jiyè","out","septanm","oktòb","novanm","desanm"],monthsShort:["jan","fev","mas","avr","me","jen","jiy","out","sep","okt","nov","des"],today:"Jodi a",suffix:[],meridiem:["am","pm"],weekStart:1,format:"dd/mm/yyyy"}}(e)}).call(t,n(1))},168:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(138),s=a(i),l=n(139),u=a(l),c=n(140),d=a(c),p=n(141),f=a(p),m=n(142),h=a(m),g=n(143),v=a(g),y=n(144),w=a(y),b=n(145),P=a(b),k=n(146),$=a(k),D=n(137),T=a(D);t.default=o.default.module("openmrs-contrib-dashboardwidgets",[s.default,u.default,d.default,f.default,h.default,v.default,w.default,P.default,$.default,T.default]).name,o.default.element(document).ready(function(){var e=!0,t=!1,n=void 0;try{for(var a,r=document.getElementsByClassName("openmrs-contrib-dashboardwidgets")[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var i=a.value;o.default.bootstrap(i,["openmrs-contrib-dashboardwidgets"])}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}})},169:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.LatestObsForConceptListComponent=void 0;var r=n(170),o=a(r),i=n(254),s=a(i);t.LatestObsForConceptListComponent={template:s.default,controller:o.default,selector:"latestobsforconceptlist",scope:{},bindings:{config:"<"}}},170:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(){function e(t,n,r,o){"ngInject";a(this,e),Object.assign(this,{$filter:t,openmrsRest:n,openmrsTranslate:o,widgetsCommons:r})}return e.$inject=["$filter","openmrsRest","widgetsCommons","openmrsTranslate"],r(e,[{key:"$onInit",value:function(){var e=this;return this.openmrsRest.setBaseAppPath("/coreapps"),this.maxAgeInDays=this.widgetsCommons.maxAgeToDays(this.config.maxAge),this.openmrsRest.list("latestobs",{patient:this.config.patientUuid,v:"custom:(obsDatetime,concept:(uuid,display,datatype:(uuid),names:(name,locale,localePreferred,voided,conceptNameType)),value:(uuid,display,names:(name,locale,localePreferred,voided,conceptNameType)),groupMembers:(value,concept:(display,names:(name,locale,localePreferred,voided,conceptNameType))))",concept:this.config.concepts.split(",").map(function(e){return e.trim()}).join(","),nLatestObs:this.config.nLatestObs||1}).then(function(t){e.obs=t.results.filter(function(t){return angular.isUndefined(e.maxAgeInDays)||e.widgetsCommons.dateToDaysAgo(t.obsDatetime)<=e.maxAgeInDays}).map(function(t){var n={obsDaysAgo:e.widgetsCommons.dateToDaysAgoMessage(t.obsDatetime)};return n.conceptName=e.widgetsCommons.getConceptName(t.concept,e.config.conceptNameType,e.config.locale),t.groupMembers?n.groupMembers=t.groupMembers.map(function(t){return{prefix:["FSN","shortName","preferred"].includes(e.config.obsGroupLabels)?"("+e.widgetsCommons.getConceptName(t.concept,e.config.obsGroupLabels,e.config.locale)+") ":"",value:e.getObsValue(t)}}):n.value=e.getObsValue(t),n})})}},{key:"getObsValue",value:function(e){return this.widgetsCommons.hasDatatypeDateOrSimilar(e.concept)?this.$filter("date")(new Date(e.value),this.config.dateFormat):this.widgetsCommons.hasDatatypeCoded(e.concept)?this.widgetsCommons.getConceptName(e.value,this.config.conceptNameType,this.config.locale):e.value.display||e.value}}]),e}();t.default=o},171:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ObsAcrossEncountersComponent=void 0;var r=n(172),o=a(r),i=n(255),s=a(i);t.ObsAcrossEncountersComponent={template:s.default,controller:o.default,selector:"obsacrossencounters",bindings:{config:"<"}}},172:function(e,t,n){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(){function e(t,n,a,o,i){"ngInject";r(this,e),Object.assign(this,{$q:t,$filter:n,openmrsRest:a,openmrsTranslate:o,widgetsCommons:i})}return e.$inject=["$q","$filter","openmrsRest","openmrsTranslate","widgetsCommons"],o(e,[{key:"$onInit",value:function(){var e=this;return this.sessionLocale=null,this.CONCEPT_CUSTOM_REP="custom:(uuid,display,names:(voided,locale,conceptNameType,localePreferred,name)",this.conceptsMap={},this.simpleEncs=[],this.headers=[],this.openmrsRest.setBaseAppPath("/coreapps"),this.isArray=angular.isArray,this.output={headers:[],rows:[],maxAgeInDays:this.widgetsCommons.maxAgeToDays(this.config.maxAge)},Promise.all([this.fetchSessionInfo(),this.fetchConcepts(),this.fetchEncounters()]).then(function(){return e.formatOutput()})}},{key:"fetchSessionInfo",value:function(){var e=this;this.openmrsRest.get("session?",{v:"ref"}).then(function(t){e.sessionLocale=t.locale},function(e){console.error("failed to retrieve session info, error: "+e)})}},{key:"fetchConcepts",value:function(){var e=this,t=this.config.concepts.split(",").map(function(e){return e.trim()});return Promise.all(t.map(function(t){return e.openmrsRest.get("concept/"+t,{v:e.CONCEPT_CUSTOM_REP}).then(function(t){t.display=e.widgetsCommons.getConceptName(t,"shortName",e.sessionLocale),e.conceptsMap[t.uuid]=t})}))}},{key:"fetchEncounters",value:function(){var e=this,t=this.config.encounterTypes?this.config.encounterTypes.split(",").map(function(e){return e.trim()}):[],n=this.config.encounterType?this.config.encounterType.split(",").map(function(e){return e.trim()}):[];t.push.apply(t,a(n));var r={patient:this.config.patientUuid,v:"custom:(uuid,encounterDatetime,encounterProviders:(uuid,provider:(uuid,name)),encounterType:(name,description),obs:(id,uuid,value,concept:(id,uuid,name:(display),datatype:(uuid)),groupMembers:(id,uuid,display,value,concept:(id,uuid,name:(display),datatype:(uuid))))",limit:this.config.maxRecords||4,fromdate:this.widgetsCommons.maxAgeToDate(this.config.maxAge)},o=t.length?t.map(function(t){return e.openmrsRest.get("encounter",Object.assign({encounterType:t},r)).then(function(e){return e.results})}):[this.openmrsRest.get("encounter",Object.assign({encounterType:""},r)).then(function(e){return e.results})];return Promise.all(o).then(function(t){return Promise.all(t.map(function(t){return e.addToSimpleEncs(t)}))})}},{key:"formatOutput",value:function(){var e=this;if(this.output.headers=this.config.headers?this.config.headers.split(","):[],0===this.output.headers.length){this.config.showEncounterTypeName&&this.output.headers.push("coreapps.patientDashBoard.encounter"),this.config.showEncounterProviderName&&this.output.headers.push("coreapps.patientDashBoard.provider"),this.output.headers.push("coreapps.date");var t=!0,n=!1,a=void 0;try{for(var r,o=Object.values(this.conceptsMap)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;this.output.headers.push(i.display)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}this.output.rows=[];for(var s=void 0,l=void 0,u=this.simpleEncs.sort(function(e,t){return e.encounterDatetime-t.encounterDatetime}),c=0;c<u.length;c++)!function(t){s="",l="";var n=u[t],a=[];e.output.rows.push(a),e.config.showEncounterTypeName&&a.push({value:n.encounterType,translate:!0}),e.config.showEncounterProviderName&&(n.encounterProviders.map(function(e,t){l+=e.provider.name,t!=n.encounterProviders.length-1&&(l+=", ")}),a.push({value:l,translate:!1})),s=e.config.showDateWithTime?e.widgetsCommons.formatDateTime(n.encounterDatetime,e.config.JSDateTimeFormat,e.config.language):e.widgetsCommons.formatDate(n.encounterDatetime,e.config.JSDateFormat,e.config.language),a.push({value:s});var r=!0,o=!1,i=void 0;try{for(var c,d=Object.keys(e.conceptsMap)[Symbol.iterator]();!(r=(c=d.next()).done);r=!0){var p=c.value,f=[];if(n.obs[p]){var m=!0,h=!1,g=void 0;try{for(var v,y=n.obs[p][Symbol.iterator]();!(m=(v=y.next()).done);m=!0){var w=v.value;f.push({value:(w?e.getObsValue(w):"")||"",className:e.isRetired(w)?"retiredConcept":""})}}catch(e){h=!0,g=e}finally{try{!m&&y.return&&y.return()}finally{if(h)throw g}}}else f.push({value:""});a.push(f)}}catch(e){o=!0,i=e}finally{try{!r&&d.return&&d.return()}finally{if(o)throw i}}}(c)}},{key:"isRetired",value:function(e){return Boolean(e&&e.value&&e.value.retired)}},{key:"getObsValue",value:function(e){return this.widgetsCommons.hasDatatypeDateOrSimilar(e.concept)?this.$filter("date")(new Date(e.value),this.config.dateFormat):this.widgetsCommons.isDrug(e.value)?this.config.useConceptNameForDrugValues?e.value.concept.display:e.value.display:e.value.display||e.value}},{key:"addToSimpleEncs",value:function(e){var t=this,n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done);a=!0)!function(){var e=i.value,a=Object.keys(t.conceptsMap),r={},o=!0,s=!1,l=void 0;try{for(var u,c=e.obs[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value;if(d.groupMembers){var p=d.groupMembers.filter(function(e){return a.includes(e.concept.uuid)});if(p.length){var f={},m=!0,h=!1,g=void 0;try{for(var v,y=p[Symbol.iterator]();!(m=(v=y.next()).done);m=!0){var w=v.value;f[w.concept.uuid]||(f[w.concept.uuid]=[]),f[w.concept.uuid].push(w)}}catch(e){h=!0,g=e}finally{try{!m&&y.return&&y.return()}finally{if(h)throw g}}t.simpleEncs.push({encounterType:e.encounterType.name,encounterDatetime:e.encounterDatetime,encounterProviders:e.encounterProviders,obs:f})}}else a.includes(d.concept.uuid)&&(r[d.concept.uuid]||(r[d.concept.uuid]=[]),r[d.concept.uuid].push(d))}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}Object.keys(r).length>0&&t.simpleEncs.push({encounterType:e.encounterType.name,encounterDatetime:e.encounterDatetime,encounterProviders:e.encounterProviders,obs:r}),t.config.useConceptShortName&&n.push(t.updateWithConceptShortNames(t.simpleEncs))}()}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}return Promise.all(n)}},{key:"updateWithConceptShortNames",value:function(e){var t=[],n=!0,a=!1,r=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value,l=!0,u=!1,c=void 0;try{for(var d,p=Object.values(s.obs)[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var f=d.value,m=!0,h=!1,g=void 0;try{for(var v,y=f[Symbol.iterator]();!(m=(v=y.next()).done);m=!0){var w=v.value;this.widgetsCommons.isDrug(w.value)?t.push(this.updateWithShortName(w.value.concept)):this.widgetsCommons.hasDatatypeCoded(w.concept)&&t.push(this.updateWithShortName(w.value))}}catch(e){h=!0,g=e}finally{try{!m&&y.return&&y.return()}finally{if(h)throw g}}}}catch(e){u=!0,c=e}finally{try{!l&&p.return&&p.return()}finally{if(u)throw c}}}}catch(e){a=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw r}}return t}},{key:"updateWithShortName",value:function(e){var t=this;return this.openmrsRest.get("concept/"+e.uuid,{v:this.CONCEPT_CUSTOM_REP}).then(function(n){e.display=t.widgetsCommons.getConceptName(n,"shortName",t.sessionLocale)}).catch(function(e){return console.error("failed to retrieve concept "+conceptUuid+", "+e)})}}]),e}();t.default=i},173:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ObsGraphComponent=void 0;var r=n(174),o=a(r),i=n(256),s=a(i);t.ObsGraphComponent={template:s.default,controller:o.default,selector:"obsgraph",bindings:{config:"<"}}},174:function(e,t,n){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=function(){function e(t,n,a,o,i){"ngInject";r(this,e),Object.assign(this,{$q:t,$filter:n,openmrsRest:a,openmrsTranslate:o,widgetsCommons:i})}return e.$inject=["$q","$filter","openmrsRest","openmrsTranslate","widgetsCommons"],i(e,[{key:"$onInit",value:function(){var e=this;e.xAxis={},this.maxAgeInDays=void 0,this.conceptRep="custom:(uuid,display,name:(display),datatype:(uuid,display))",this.customRep="custom:(uuid,display,obsDatetime,value,encounter:(encounterType),concept:(uuid,display,name:(display),datatype:(uuid,display)))",this.series=[],this.labels=[],this.data=[],this.legend=[],this.dataset=[],this.openmrsRest.setBaseAppPath("/coreapps"),this.FunctionManager={bmi:function(t,n){var a=arguments;if(arguments&&arguments.length>0){for(var r=0;r<arguments.length;r++)!function(t){var n=e.conceptArray.find(function(e){return e.uuid===a[t]});e.conceptArray&&void 0===n&&e.conceptArray.push({uuid:a[t],type:"obs",legend:!1})}(r);e.conceptArray.push({uuid:null,type:"function",legend:!0,function:["calculateBmi",t,n]})}return!0},calculateBmi:function(t,n){if(t&&n){var a=e.dataset.find(function(e){return e.uuid===t}),r=e.dataset.find(function(e){return e.uuid===n});if(a&&r){var i=e.getXAxisKeys();if(null!==i&&i.length>0){for(var s=[],l=0;l<i.length;l++){var u=parseInt(a.values[i[l]]),c=parseInt(r.values[i[l]]),d=null;void 0!==(void 0===u?"undefined":o(u))&&null!==u&&void 0!==(void 0===c?"undefined":o(c))&&null!==c&&(d=(c/u/u*1e4).toFixed(1)),s.push(d)}e.series.push("BMI"),e.data.push(s)}}}return null},execute:function(t){return e.FunctionManager[t]&&e.FunctionManager[t].apply(e.FunctionManager,[].slice.call(arguments,1))}},this.orderXAxis=function(){var e=this.getXAxisKeys();if(null!==e&&e.length>0)for(var t=0;t<e.length;t++)this.labels.push(this.xAxis[e[t]])},this.updateChartData=function(){var e=this;if(angular.isDefined(this.dataset)&&this.dataset.length>0){var t=this.getXAxisKeys();if(null!==t&&t.length>0)for(var n=0;n<this.conceptArray.length;n++){(function(n){var r=e.conceptArray[n];if(void 0!==e.hideConcepts&&e.hideConcepts.length&&e.hideConcepts.includes(r.uuid))return"continue";if(!0===r.legend)if(r.uuid&&"obs"===r.type){var o=e.dataset.find(function(e){return e.uuid===r.uuid});if(angular.isDefined(o)&&null!==o&&angular.isDefined(o.values)&&null!==o.values&&Object.keys(o.values).length>0){for(var i=[],s=0;s<t.length;s++){var l=o.values[t[s]];(angular.isUndefined(l)||null==l)&&(l=null),i.push(l)}e.data.push(i)}else{var u=e.series.indexOf(r.display);u>=0&&e.series.splice(u,1)}}else if("function"===r.type&&r.function){var c;(c=e.FunctionManager).execute.apply(c,a(r.function))}})(n)}}},this.getConceptNames=function(){var t=[];if(null!==this.conceptArray&&this.conceptArray.length>0)for(var n=0;n<this.conceptArray.length;n++)if(this.conceptArray[n].uuid){var a=this.openmrsRest.get("concept/"+this.conceptArray[n].uuid,{v:this.conceptRep}).then(function(e){return e});t.push(a)}return this.$q.all(t).then(function(t){for(var n=0;n<e.conceptArray.length;n++)!function(n){var a=e.conceptArray[n];if(!0===a.legend){var r=t.find(function(e){return e.uuid===a.uuid});r&&r.display&&(e.series.push(r.display),e.conceptArray[n].display=r.display)}}(n)})},this.getAllObs=function(){var t=[];if(null!==this.conceptArray&&this.conceptArray.length>0)for(var n=0;n<this.conceptArray.length;n++)if(this.conceptArray[n].uuid){var a=this.openmrsRest.list("obs",{patient:this.config.patientUuid,v:this.customRep,limit:this.config.maxResults,concept:this.conceptArray[n].uuid}).then(function(e){return e.results});t.push(a)}return this.$q.all(t).then(function(t){for(var n=0;n<t.length;n++){var a={},r=t[n];if(r.length>0){a.uuid=r[0].concept.uuid,a.display=r[0].concept.display,a.values={};for(var o=0;o<r.length;o++){var i=r[o];if(!function(t){return angular.isDefined(e.encounterTypes)&&e.encounterTypes.indexOf(t)<0}(function(e){return angular.isUndefined(e)?null:e.encounter.encounterType.uuid}(i))&&"Numeric"==i.concept.datatype.display){var s=e.widgetsCommons.daysSinceDate(i.obsDatetime);if(angular.isUndefined(e.maxAgeInDays)||s<=e.maxAgeInDays){var l=e.widgetsCommons.formatDate(i.obsDatetime,e.config.JSDateFormat,e.config.language);a.values[s]=i.value,e.xAxis[s]=l}}}}e.dataset.push(a)}e.orderXAxis()})},this.getConfig();var t=this.getConceptNames(),n=this.getAllObs();this.$q.all([t,n]).then(function(){e.updateChartData()})}},{key:"getConfig",value:function(){angular.isUndefined(this.config.maxResults)&&(this.config.maxResults=4),this.maxAgeInDays=this.widgetsCommons.maxAgeToDays(this.config.maxAge),angular.isDefined(this.config.encounterTypes)&&(this.encounterTypes=this.config.encounterTypes.replace(/ /gi,"").split(",")),angular.isUndefined(this.config.showLegend)&&(this.config.showLegend=!0),angular.isDefined(this.config.hideConcepts)&&(this.hideConcepts=this.config.hideConcepts.replace(/ /gi,"").split(",")),this.options={legend:{display:this.config.showLegend,position:"top"},scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left"}]}},this.config.type&&"logarithmic"===this.config.type&&(this.options.scales.yAxes[0]={id:"y-axis-1",type:"logarithmic",display:!0,position:"left",ticks:{callback:function(e,t,n){return e.length?Number(e).toLocaleString():e},autoSkip:!0,maxTicksLimit:5}});var e=this.config.conceptId.replace(/ /gi,"").split(",");this.conceptArray=e.map(function(e){return{uuid:e,type:"obs",legend:!0,display:""}}),this.config.function&&this.config.function.length>0&&this.parseFunctionConfig(this.config.function)}},{key:"parseFunctionConfig",value:function(e){if(e){var t=e.replace(/ /gi,"").split(";");if(angular.isDefined(t)&&null!==t&&t.length>0)for(var n=0;n<t.length;n++){var r=t[n];if(r&&r.length>0){var o=r.substring(r.indexOf("(")+1,r.indexOf(")"));if(o&&o.length>0){var i=o.split(",");if(i&&i.length>0){var s;(s=this.FunctionManager).execute.apply(s,a(i))}}}}}}},{key:"getXAxisKeys",value:function(){var e=null;return angular.isDefined(this.xAxis)&&this.xAxis&&(e=Object.keys(this.xAxis))&&e.length>0&&e.sort(function(e,t){return parseInt(t)-parseInt(e)}),e}}]),e}();t.default=s},175:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramsComponent=void 0;var r=n(176),o=a(r),i=n(257),s=a(i);t.ProgramsComponent={template:s.default,controller:o.default,selector:"programs",bindings:{config:"<"}}},176:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(t,n,r,o){"ngInject";a(this,e),Object.assign(this,{$filter:t,openmrsRest:n,openmrsTranslate:r,widgetsCommons:o})}return e.$inject=["$filter","openmrsRest","openmrsTranslate","widgetsCommons"],r(e,[{key:"$onInit",value:function(){this.dashboardPage="/coreapps/clinicianfacing/patient.page?patientId={{patientUuid}}&dashboard={{dashboard}}",this.programs=[],this.unenrolledPrograms=[],this.patientPrograms=[],this.showAddProgram=!1,this.canEnrollInProgram=!1,this.input={program:""},this.dateFormat=""==this.config.dateFormat||i.default.isUndefined(this.config.dateFormat)?"yyyy-MM-dd":this.config.dateFormat,this.supportedPrograms=[],this.config.supportedPrograms&&(this.supportedPrograms=this.config.supportedPrograms.split(",")),this.activate()}},{key:"activate",value:function(){this.openmrsRest.setBaseAppPath("/coreapps"),this.config.dashboardPage&&(this.dashboardPage=this.config.dashboardPage),this.fetchPrivileges(),this.fetchPrograms().then(this.fetchPatientPrograms.bind(this)).then(this.determineUnenrolledPrograms.bind(this))}},{key:"fetchPrivileges",value:function(){var e=this;this.openmrsRest.get("session",{v:"custom:(privileges:(name))"}).then(function(t){t&&t.user&&i.default.isArray(t.user.privileges)&&(e.widgetsCommons.isSystemDeveloper(t.user)?e.canEnrollInProgram=!0:t.user.privileges.some(function(e){return"Task: coreapps.enrollInProgram"===e.name})&&(e.canEnrollInProgram=!0))},function(e){console.log("failed to retrieve user privileges, error: "+e)})}},{key:"fetchPrograms",value:function(){var e=this;return this.openmrsRest.get("program",{v:"custom:display,uuid"}).then(function(t){e.getPrograms(t.results)})}},{key:"fetchPatientPrograms",value:function(){var e=this;return this.openmrsRest.get("programenrollment",{patient:this.config.patientUuid,voided:!1,limit:this.getMaxRecords(),v:"custom:program:(uuid,display),dateEnrolled,dateCompleted"}).then(function(t){e.getPatientPrograms(t.results)})}},{key:"getPrograms",value:function(e){var t=this;i.default.forEach(e,function(e){0!=t.supportedPrograms.length&&-1==t.supportedPrograms.indexOf(e.uuid)||t.programs.push(e)})}},{key:"getPatientPrograms",value:function(e){var t=this;this.patientPrograms=[],i.default.forEach(e,function(e){0!=t.supportedPrograms.length&&-1==t.supportedPrograms.indexOf(e.program.uuid)||t.patientPrograms.push(e)})}},{key:"getMaxRecords",value:function(){return""==this.config.maxRecords||i.default.isUndefined(this.config.maxRecords)?20:this.config.maxRecords}},{key:"determineUnenrolledPrograms",value:function(){var e=[];i.default.forEach(this.patientPrograms,function(t){t.dateCompleted||e.push(t.program.uuid)}),this.unenrolledPrograms=this.$filter("filter")(this.programs,function(t){return-1==e.indexOf(t.uuid)})}},{key:"addProgram",value:function(){this.showAddProgram=!0}},{key:"cancelAddProgram",value:function(){this.showAddProgram=!1,this.input.program=""}},{key:"gotoProgramDashboard",value:function(e,t){if((t=t||this.input.program)&&this.config.enableProgramDashboards){var n="";n=Handlebars.compile(this.dashboardPage)({patientUuid:this.config.patientUuid,dashboard:t}),this.openmrsRest.getServerUrl().then(function(t){var a=t+n;console.log(e),e.metaKey||e.ctrlKey||e.shiftKey?window.open(a,"_blank"):window.location.href=a})}}}]),e}();t.default=s},177:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramStatisticsComponent=void 0;var r=n(178),o=a(r),i=n(258),s=a(i);t.ProgramStatisticsComponent={template:s.default,controller:o.default,selector:"programstatistics",bindings:{config:"<"}}},178:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),i=(function(e){e&&e.__esModule}(o),function(){function e(t,n,r){"ngInject";a(this,e),Object.assign(this,{$filter:t,openmrsRest:n,openmrsTranslate:r})}return e.$inject=["$filter","openmrsRest","openmrsTranslate"],r(e,[{key:"$onInit",value:function(){this.activate()}},{key:"activate",value:function(){this.openmrsRest.setBaseAppPath("/coreapps"),this.getEverEnrolledInProgram(),this.getCurrentlyEnrolledInProgram()}},{key:"getEverEnrolledInProgram",value:function(){var e=this;return this.openmrsRest.get("reportingrest/cohort",{v:"ref",uuid:"reporting.library.cohortDefinition.builtIn.patientsWithEnrollment",programs:[this.config.program]}).then(function(t){e.everEnrolled=t&&"count"in t?t.count:e.$filter("translate")("coreapps.dashboardwidgets.programstatistics.error")})}},{key:"getCurrentlyEnrolledInProgram",value:function(){var e=this;return this.openmrsRest.get("reportingrest/cohort",{v:"ref",uuid:"reporting.library.cohortDefinition.builtIn.patientsInProgram",programs:[this.config.program],onDate:new Date}).then(function(t){e.currentlyEnrolled=t&&"count"in t?t.count:e.$filter("translate")("coreapps.dashboardwidgets.programstatistics.error")})}}]),e}());t.default=i},179:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramStatusComponent=void 0;var r=n(180),o=a(r),i=n(259),s=a(i);t.ProgramStatusComponent={template:s.default,controller:o.default,selector:"programstatus",bindings:{config:"<"}}},180:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=n(2),s=a(i),l=n(0),u=a(l),c=function(){function e(t,n,a,o,i,s){"ngInject";r(this,e),Object.assign(this,{$filter:t,$window:n,$q:a,openmrsRest:o,openmrsTranslate:i,widgetsCommons:s})}return e.$inject=["$filter","$window","$q","openmrsRest","openmrsTranslate","widgetsCommons"],o(e,[{key:"$onInit",value:function(){this.vPatientProgram="custom:uuid,program:(uuid),dateEnrolled,dateCompleted,dateCreated,outcome:(display),location:(display,uuid),dateCompleted,outcome,states:(uuid,startDate,endDate,dateCreated,voided,state:(uuid,concept:(display)))",this.dateFormat=""==this.config.dateFormat||s.default.isUndefined(this.config.dateFormat)?"dd-MMM-yyyy":this.config.dateFormat,this.today=new Date,this.loaded=!1,this.deleted=!1,this.program=null,this.patientProgram=null,this.patientPrograms=null,this.programLocations=null,this.programOutcomes=null,this.sessionLocation=null,this.expandedWorkflows="boolean"==typeof this.config.expandedWorkflows&&this.config.expandedWorkflows,this.minEnrollmentDate=null,this.maxCompletionDate=null,this.canEnrollInProgram=!1,this.canEditProgram=!1,this.canDeleteProgram=!1,this.statesByWorkflow={},this.statesByUuid={},this.sortedStatesByWorkflow={},this.markPatientDeadOutcome=null,this.markPatientDeadPage="/coreapps/markPatientDead.page?patientId={{patientUuid}}&returnDashboard={{dashboard}}&defaultDeathDate={{date}}&defaultDead=true",this.canMarkPatientDead=!1,this.requestInProgress=!1,this.dashboard=null,this.input={dateEnrolled:null,enrollmentLocation:null,dateCompleted:null,outcome:null,initialWorkflowStateByWorkflow:{},changeToStateByWorkflow:{}},this.resetWindowStates();return this.activate()}},{key:"activate",value:function(){return this.openmrsRest.setBaseAppPath("/coreapps"),this.config.dashboard&&(this.dashboard=this.config.dashboard),this.config.markPatientDeadOutcome&&(this.markPatientDeadOutcome=this.config.markPatientDeadOutcome),this.config.markPatientDeadPage&&(this.markPatientDeadPage=this.config.markPatientDeadPage),this.fetchPrivileges(),this.fetchSessionLocation(),this.fetchLocations().then(this.fetchProgram.bind(this)).then(this.fetchOutcomes.bind(this)).then(this.fetchPatientProgram.bind(this))}},{key:"fetchPrivileges",value:function(){var e=this;this.openmrsRest.get("session").then(function(t){t&&t.user&&s.default.isArray(t.user.privileges)&&(e.widgetsCommons.isSystemDeveloper(t.user)?(e.canEnrollInProgram=!0,e.canEditProgram=!0,e.canDeleteProgram=!0,e.canMarkPatientDead=!0):(t.user.privileges.some(function(e){return"Task: coreapps.enrollInProgram"===e.name})&&(e.canEnrollInProgram=!0),t.user.privileges.some(function(e){return"Task: coreapps.editPatientProgram"===e.name})&&(e.canEditProgram=!0),t.user.privileges.some(function(e){return"Task: coreapps.deletePatientProgram"===e.name})&&(e.canDeleteProgram=!0),t.user.privileges.some(function(e){return"Task: coreapps.markPatientDead"===e.name})&&(e.canMarkPatientDead=!0)))},function(e){console.log("failed to retrieve user privileges, error: "+e)})}},{key:"setInputsToStartingValues",value:function(){var e=this;if(this.input.dateEnrolled=this.patientProgram?new Date(this.patientProgram.dateEnrolled):new Date,this.input.dateCompleted=this.patientProgram&&this.patientProgram.dateCompleted?new Date(this.patientProgram.dateCompleted):null,this.input.outcome=this.patientProgram&&this.patientProgram.outcome?this.patientProgram.outcome.uuid:null,this.patientProgram&&this.patientProgram.location)this.input.enrollmentLocation=this.patientProgram.location.uuid;else if(this.programLocations&&1==this.programLocations.length)this.input.enrollmentLocation=this.programLocations[0].uuid;else if(this.programLocations&&this.sessionLocation){var t=this.$filter("filter")(this.programLocations,function(t){return t.uuid==e.sessionLocation.uuid})[0];t&&(this.input.enrollmentLocation=t.uuid)}this.input.initialWorkflowStateByWorkflow={},this.input.changeToStateByWorkflow={}}},{key:"convertDateEnrolledAndDateCompletedStringsToDates",value:function(){this.patientProgram&&(this.patientProgram.dateEnrolled=this.patientProgram?new Date(this.patientProgram.dateEnrolled):null,this.patientProgram.dateCompleted=this.patientProgram&&this.patientProgram.dateCompleted?this.toUTCDate(this.patientProgram.dateCompleted):null)}},{key:"toggleEditEnrollment",value:function(){var e=this.edit.enrollment;this.cancelAllEditModes(),this.setInputsToStartingValues(),this.edit.enrollment=!e}},{key:"toggleEditWorkflow",value:function(e){var t=this.edit.workflow[e];this.cancelAllEditModes(),this.setInputsToStartingValues(),!e in this.edit.workflow?this.edit.workflow[e]=!0:this.edit.workflow[e]=!t}},{key:"toggleExpandedWorkflow",value:function(e){this.expanded.workflow[e]=!this.expanded.workflow[e]}},{key:"initExpandedWorkflows",value:function(){var e=this;s.default.forEach(this.program.workflows,function(t){e.expanded.workflow[t.uuid]=e.expandedWorkflows})}},{key:"fetchProgram",value:function(){var e=this;return this.openmrsRest.get("program",{uuid:this.config.program,v:"custom:display,uuid,outcomesConcept:(uuid),workflows:(uuid,concept:(display),states:(uuid,initial,terminal,concept:(display))"}).then(function(t){e.program=t,s.default.forEach(e.program.workflows,function(t){e.statesByWorkflow[t.uuid]=t.states,s.default.forEach(t.states,function(t){e.statesByUuid[t.uuid]=t})})})}},{key:"fetchPatientProgram",value:function(){var e=this;return this.loaded=!1,this.patientProgram=null,this.resetWindowStates(),this.openmrsRest.get("programenrollment",{patient:this.config.patientUuid,v:this.vPatientProgram}).then(function(t){e.patientPrograms=t.results,e.getPatientProgramFromPatientProgramList(),e.groupAndSortPatientStates(),e.setInputsToStartingValues(),e.convertDateEnrolledAndDateCompletedStringsToDates(),e.initExpandedWorkflows(),e.loaded=!0})}},{key:"fetchLocations",value:function(){var e=this,t=this.$window.sessionContext.locationsPromise;return t||(t=this.openmrsRest.get("location",{v:"custom:display,uuid",tag:this.config.locationTag}),this.$window.sessionContext.locationsPromise=t),t.then(function(t){return e.programLocations=t.results,t})}},{key:"fetchSessionLocation",value:function(){var e=this;return this.openmrsRest.get("appui/session",{v:"custom:name,uuid"}).then(function(t){e.sessionLocation=t.sessionLocation})}},{key:"fetchOutcomes",value:function(){var e=this;if(this.program.outcomesConcept)return this.openmrsRest.get("concept",{v:"custom:answers:(display,uuid)",uuid:this.program.outcomesConcept.uuid}).then(function(t){e.programOutcomes=t.answers})}},{key:"getPatientProgramFromPatientProgramList",value:function(){var e=this;this.patientPrograms=this.$filter("filter")(this.patientPrograms,function(t){return t.program.uuid==e.config.program}),this.patientPrograms.length>0&&(this.patientPrograms=this.$filter("orderBy")(this.patientPrograms,null,!1,this.patientProgramComparator),this.displayActiveProgram()?this.patientPrograms[0].dateCompleted?this.minEnrollmentDate=new Date(this.patientPrograms[0].dateCompleted):(this.patientProgram=this.patientPrograms[0],this.patientPrograms.length>1&&(this.minEnrollmentDate=new Date(this.patientPrograms[1].dateCompleted))):s.default.forEach(this.patientPrograms,function(t,n){t.uuid==e.config.patientProgram&&(e.patientProgram=t,n>0&&(e.maxCompletionDate=new Date(e.patientPrograms[n-1].dateEnrolled)),n+1<e.patientPrograms.length&&(e.minEnrollmentDate=new Date(e.patientPrograms[n+1].dateCompleted)))}))}},{key:"enrollInProgram",value:function(){var e=this;if(this.input.dateEnrolled&&this.input.enrollmentLocation){this.requestInProgress=!0;var t=[];s.default.forEach(this.input.initialWorkflowStateByWorkflow,function(n){n.startDate=e.dateWithoutTime(e.input.dateEnrolled),t.push(n)}),this.openmrsRest.create("programenrollment",{patient:this.config.patientUuid,program:this.config.program,dateEnrolled:this.input.dateEnrolled,location:this.input.enrollmentLocation,states:t}).then(function(t){e.config.disableReloadPage?(e.fetchPatientProgram(e.patientProgram.uuid),e.requestInProgress=!1):e.reloadPage()})}}},{key:"updatePatientProgram",value:function(){var e=this,t=!this.config.disableReloadPage&&this.input.dateEnrolled.getTime()!=this.patientProgram.dateEnrolled.getTime()||this.input.dateCompleted&&!this.patientProgram.dateCompleted||!this.input.dateCompleted&&this.patientProgram.dateCompleted||this.input.dateCompleted&&this.patientProgram.dateCompleted&&this.input.dateCompleted.getTime()!=this.patientProgram.dateCompleted.getTime();this.openmrsRest.update("programenrollment/"+this.patientProgram.uuid,{dateEnrolled:this.input.dateEnrolled,dateCompleted:this.input.dateCompleted,location:this.input.enrollmentLocation,outcome:this.input.outcome}).then(function(n){if(e.markPatientDeadOutcome&&e.canMarkPatientDead&&(n.outcome&&n.outcome.uuid===e.markPatientDeadOutcome||e.patientProgram.outcome&&e.patientProgram.outcome.uuid==e.markPatientDeadOutcome)){var a=Handlebars.compile(e.markPatientDeadPage)({patientUuid:e.config.patientUuid,dashboard:e.config.dashboard,date:n.dateCompleted});e.openmrsRest.getServerUrl().then(function(e){var t=e+a;window.location.href=t})}else t?e.reloadPage():e.fetchPatientProgram(e.patientProgram.uuid)})}},{key:"deletePatientProgram",value:function(){var e=this;this.confirmDelete.enrollment?(this.confirmDelete.enrollment=!1,this.openmrsRest.remove("programenrollment/",{uuid:this.patientProgram.uuid}).then(function(t){e.patientProgram=null,e.displayActiveProgram()?e.fetchPatientProgram():(e.deleted=!0,e.config.disableReloadPage||e.reloadPage())})):this.confirmDelete.enrollment=!0}},{key:"deleteMostRecentPatientState",value:function(e){this.confirmDelete.workflow[e]?(this.confirmDelete.workflow[e]=!1,e in this.sortedStatesByWorkflow&&this.sortedStatesByWorkflow[e].length>0&&this.voidPatientState(this.sortedStatesByWorkflow[e][0].uuid)):this.confirmDelete.workflow[e]=!0}},{key:"createPatientState",value:function(e){var t=this;this.openmrsRest.update("programenrollment/"+this.patientProgram.uuid,{states:[{state:e.state,startDate:this.dateWithoutTime(e.date)}]}).then(function(n){t.statesByUuid[e.state].terminal?t.reloadPage():t.fetchPatientProgram(t.patientProgram.uuid)})}},{key:"getWorkflowForState",value:function(e){var t=void 0;return s.default.forEach(this.program.workflows,function(n){s.default.forEach(n.states,function(a){e.uuid==a.uuid&&(t=n)})}),t}},{key:"voidPatientState",value:function(e){var t=this;return this.openmrsRest.remove("programenrollment/"+this.patientProgram.uuid+"/state/"+e,{voided:"true",voidReason:"voided via UI"}).then(function(e){t.fetchPatientProgram(t.patientProgram.uuid)})}},{key:"updatePatientState",value:function(e,t){this.edit.workflow[e]=!1,this.createPatientState(this.input.changeToStateByWorkflow[e])}},{key:"isNotCurrentState",value:function(e){var t=this;return function(n){var a=e.uuid in t.sortedStatesByWorkflow?t.sortedStatesByWorkflow[e.uuid][0]:null;return!a||a.state.uuid!=n.uuid}}},{key:"isInitialState",value:function(){return function(e){return e.initial}}},{key:"groupAndSortPatientStates",value:function(){var e=this;this.sortedStatesByWorkflow={},this.patientProgram&&this.patientProgram.states&&(this.patientProgram.states=this.$filter("filter")(this.patientProgram.states,function(e){return!e.voided},!0),this.patientProgram.states=this.$filter("orderBy")(this.patientProgram.states,null,!1,function(e,t){if("number"===e.type&&"number"===t.type)return e.value-t.value;if(null!=e.value.endDate||null!=t.value.endDate){if(null==t.value.endDate)return-1;if(null==e.value.endDate)return 1;if(new Date(e.value.startDate)<new Date(t.value.startDate))return-1;if(new Date(e.value.startDate)>new Date(t.value.startDate))return 1;if(new Date(e.value.endDate)<new Date(t.value.endDate))return-1;if(new Date(e.value.endDate)>new Date(t.value.endDate))return 1;if(new Date(e.value.dateCreated)<new Date(t.value.dateCreated))return-1;if(new Date(e.value.dateCreated)>new Date(t.value.dateCreated))return 1}return 0}),s.default.forEach(this.patientProgram.states,function(t){var n=e.getWorkflowForState(t.state);if(null!=n){n.uuid in e.sortedStatesByWorkflow||(e.sortedStatesByWorkflow[n.uuid]=[]);var a={startDate:e.toUTCDate(t.startDate),dayAfterStartDate:e.getNextDay(t.startDate),endDate:e.toUTCDate(t.endDate),state:t.state,uuid:t.uuid};e.sortedStatesByWorkflow[n.uuid].unshift(a)}}))}},{key:"getMostRecentStateChangeDate",value:function(){var e=null;return s.default.forEach(this.sortedStatesByWorkflow,function(t){t.length>0&&(!e||t[0].startDate>e)&&(e=t[0].startDate)}),e}},{key:"update",value:function(){this.cancelAllEditModes(),this.updatePatientProgram()}},{key:"cancelAllEditModes",value:function(){this.edit.enrollment=!1;for(var e in this.edit.workflow)this.edit.workflow[e]=!1}},{key:"cancelEdit",value:function(){this.cancelAllEditModes(),this.setInputsToStartingValues()}},{key:"cancelEnrollment",value:function(){this.expanded.enrollment=!1,this.setInputsToStartingValues()}},{key:"cancelDelete",value:function(){this.confirmDelete={enrollment:!1,workflow:{}}}},{key:"inConfirmDelete",value:function(){if(!0===this.confirmDelete.enrollment)return!0;var e=!1;return s.default.forEach(this.confirmDelete.workflow,function(t,n){!0===t&&(e=!0)}),e}},{key:"inEditMode",value:function(){if(!0===this.edit.enrollment)return!0;var e=!1;return s.default.forEach(this.edit.workflow,function(t,n){!0===t&&(e=!0)}),e}},{key:"getNextDay",value:function(e){return(0,u.default)(e).add(1,"days").toDate()}},{key:"getPreviousDay",value:function(e){return(0,u.default)(e).add(-1,"days").toDate()}},{key:"isToday",value:function(e){return!!e&&(0,u.default)(e).isSame((0,u.default)(),"day")}},{key:"isMostRecentProgram",value:function(){return!this.patientPrograms||0==this.patientPrograms.length||!this.patientProgram||this.patientPrograms[0].uuid===this.patientProgram.uuid}},{key:"displayActiveProgram",value:function(){return!this.config.patientProgram}},{key:"programIsCompleted",value:function(){return!(!this.patientProgram||!this.patientProgram.dateCompleted)}},{key:"enrollmentValid",value:function(){return this.input.enrollmentLocation&&this.input.dateEnrolled&&(!this.input.dateCompleted||this.input.dateCompleted>=this.input.dateEnrolled)&&(!this.input.dateCompleted&&!this.input.outcome||this.input.dateCompleted&&this.input.outcome)&&(this.isMostRecentProgram()||this.input.dateCompleted)&&!this.requestInProgress}},{key:"workflowTransitionValid",value:function(e){return this.input.changeToStateByWorkflow[e]&&this.input.changeToStateByWorkflow[e].date&&this.input.changeToStateByWorkflow[e].state}},{key:"resetWindowStates",value:function(){this.edit={enrollment:!1,workflow:{}},this.expanded={enrollment:!1,workflow:{}},this.confirmDelete={enrollment:!1,workflow:{}}}},{key:"reloadPage",value:function(){this.$window.location.reload()}},{key:"dateWithoutTime",value:function(e){return(0,u.default)(e).format("YYYY-MM-DD")}},{key:"toUTCDate",value:function(e){var t=null;return e&&(t=new Date(e),t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3)),t}},{key:"patientProgramComparator",value:function(e,t){var n=new Date(e.value.dateEnrolled),a=new Date(t.value.dateEnrolled);if(n>a)return-1;if(n<a)return 1;var r=e.value.dateCompleted?new Date(e.value.dateCompleted):null,o=t.value.dateCompleted?new Date(t.value.dateCompleted):null;if(null===r)return-1;if(null===o)return 1;if(r>o)return-1;if(r<o)return 1;var i=e.value.dateCreated,s=t.value.dateCreated;return i>s?-1:i<s?1:e.value.uuid<t.value.uuid?-1:1}}]),e}();t.default=c},181:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RelationshipsComponent=void 0;var r=n(182),o=a(r),i=n(260),s=a(i);t.RelationshipsComponent={template:s.default,controller:o.default,selector:"relationships",bindings:{config:"<"}}},182:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(t,n,r){"ngInject";a(this,e),Object.assign(this,{$q:t,openmrsRest:n,openmrsTranslate:r})}return e.$inject=["$q","openmrsRest","openmrsTranslate"],r(e,[{key:"$onInit",value:function(){this.minSearchLength=2,this.dashboardPage="/coreapps/clinicianfacing/patient.page?patientId={{patientUuid}}",this.providerPage=null,this.relationships=[],this.types=[],this.allowedTypes=[],this.relationshipType=[],this.hasEditPrivileges=!1,this.edit=!1,this.removeFlag=!1,this.showFindOtherPerson=!1,this.showSaveButton=!1,this.searchPerson=null,this.otherPerson=null,this.relatedPersons=[],this.activate()}},{key:"activate",value:function(){var e=this;this.config.baseAppPath?this.openmrsRest.setBaseAppPath(this.config.baseAppPath):this.openmrsRest.setBaseAppPath("/coreapps"),this.config.dashboardPage&&(this.dashboardPage=this.config.dashboardPage),this.config.providerPage&&(this.providerPage=this.config.providerPage),this.config.includeRelationshipTypes&&(this.allowedTypes=this.config.includeRelationshipTypes.split(",")),this.openmrsRest.get("session",{v:"custom:(privileges:(name))"}).then(function(t){e.getPrivileges(t.user.privileges)},function(e){console.log("failed to retrieve user privileges, error: "+e)}),this.openmrsRest.get("relationship",{person:this.config.patientUuid,limit:this.getMaxRecords(),v:"custom:(uuid,personA:(uuid,display,personName,birthdate,isPatient,personId),personB:(uuid,display,personName,birthdate,isPatient,personId),relationshipType)"}).then(function(t){e.getRelationships(t.results),e.providerPage&&e.checkForProviders()}),this.openmrsRest.get("relationshiptype",{v:"default"}).then(function(t){e.getRelationshipTypes(t.results)})}},{key:"getRelationships",value:function(e){var t=this;i.default.forEach(e,function(e){var n={};n.uuid=e.uuid,n.isProvider=!1,e.personA.uuid!==t.config.patientUuid?(n.toPerson=e.personA,n.isPatient=e.personA.isPatient,n.type=i.default.isDefined(e.relationshipType.displayAIsToB)?e.relationshipType.displayAIsToB:e.relationshipType.aIsToB):(n.toPerson=e.personB,n.isPatient=e.personB.isPatient,n.type=i.default.isDefined(e.relationshipType.displayBIsToA)?e.relationshipType.displayBIsToA:e.relationshipType.bIsToA),t.relationships.push(n)})}},{key:"relationshipsContain",value:function(e){var t=!1;return i.default.forEach(this.relationships,function(n){n.toPerson.uuid==e&&(t=!0)}),t}},{key:"getPrivileges",value:function(e){var t=this.config.editPrivilege;i.default.isDefined(t)&&i.default.isArray(e)&&e.some(function(e){return e.name===t})&&(this.hasEditPrivileges=!0)}},{key:"updateProviderInfo",value:function(e){e&&i.default.forEach(this.relationships,function(t){t.toPerson.uuid===e.person.uuid&&(t.isProvider=!0)})}},{key:"isProvider",value:function(e,t){return this.openmrsRest.get("provider",{q:t,v:"custom:(uuid,identifier,display,person:(uuid,personId,display,gender,age,birthdate,birthdateEstimated))"}).then(function(e){return e.results})}},{key:"checkForProviders",value:function(){var e=this;i.default.forEach(this.relationships,function(t){e.isProvider(t.toPerson.uuid,t.toPerson.display).then(function(t){i.default.forEach(t,function(t){e.updateProviderInfo(t)})})})}},{key:"getPersons",value:function(e){var t=this;this.openmrsRest.get("patient",{q:e,v:"custom:(uuid,display,gender,age)"}).then(function(e){t.relatedPersons=[],t.filterSearchedPersons(e.results)})}},{key:"filterSearchedPersons",value:function(e){var t=this;i.default.isArray(e)&&e.length>0&&i.default.forEach(e,function(e){t.relationshipsContain(e.uuid)||t.relatedPersons.push(e)})}},{key:"getRelationshipTypes",value:function(e){var t=this;i.default.forEach(e,function(e){if(t.allowedTypes.length<1||t.allowedTypes.length>0&&-1!==t.allowedTypes.indexOf(e.uuid)){if(null==t.findRelTypeByName(i.default.isDefined(e.displayAIsToB)?e.displayAIsToB:e.aIsToB)){var n={};n.uuid=e.uuid,n.name=i.default.isDefined(e.displayAIsToB)?e.displayAIsToB:e.aIsToB,n.type="B",t.types.push(n)}if(null==t.findRelTypeByName(i.default.isDefined(e.displayBIsToA)?e.displayBIsToA:e.bIsToA)){var a={};a.uuid=e.uuid,a.name=i.default.isDefined(e.displayBIsToA)?e.displayBIsToA:e.bIsToA,a.type="A",t.types.push(a)}}})}},{key:"updateRelationshipType",value:function(){i.default.isDefined(this.relationshipType)&&(this.showFindOtherPerson=!0)}},{key:"findRelTypeByName",value:function(e){var t=null;return i.default.isDefined(this.types)&&this.types.length>0&&i.default.forEach(this.types,function(n){n.name==e&&(t=n)}),t}},{key:"getMaxRecords",value:function(){return""==this.config.maxRecords||i.default.isUndefined(this.config.maxRecords)?6:this.config.maxRecords}},{key:"navigateTo",value:function(e){var t=this,n="";i.default.forEach(this.relationships,function(a){a.toPerson.uuid===e&&(!0===a.isPatient?t.dashboardPage&&(n=Handlebars.compile(t.dashboardPage)({patientUuid:e})):!0===a.isProvider&&t.providerPage&&(n=Handlebars.compile(t.providerPage)({personUuid:e})))}),this.openmrsRest.getServerUrl().then(function(e){window.location.href=e+n})}},{key:"addRelationship",value:function(){this.edit=!0}},{key:"save",value:function(){var e=this;if(i.default.isDefined(this.relationshipType)&&i.default.isDefined(this.otherPerson)){var t=null,n=null;"A"==this.relationshipType.type?(t=this.config.patientUuid,n=this.otherPerson.uuid):"B"==this.relationshipType.type&&(t=this.otherPerson.uuid,n=this.config.patientUuid),this.openmrsRest.create("relationship",{relationshipType:this.relationshipType.uuid,personA:t,personB:n}).then(function(t){e.$onInit()})}}},{key:"removeRelationship",value:function(e){if(i.default.isDefined(e)){this.removeFlag=!0;var t=[];i.default.forEach(this.relationships,function(n){n.uuid==e&&t.push(n)}),this.relationships=[],this.relationships=t}}},{key:"remove",value:function(){var e=this;i.default.isDefined(this.relationships)&&1==this.relationships.length&&this.openmrsRest.remove("relationship",{uuid:this.relationships[0].uuid}).then(function(t){e.$onInit()})}},{key:"goTo",value:function(e){this.navigateTo(e)}},{key:"searchPersons",value:function(){i.default.isDefined(this.searchPerson)&&this.searchPerson.length>this.minSearchLength&&this.getPersons(this.searchPerson)}},{key:"onSelect",value:function(e,t,n){i.default.isDefined(e)&&i.default.isDefined(this.relationshipType)&&(this.otherPerson=e,this.showSaveButton=!0)}},{key:"cancel",value:function(){this.edit=!1,this.$onInit()}}]),e}();t.default=s},183:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.VisitByEncounterTypeComponent=void 0;var r=n(184),o=a(r),i=n(261),s=a(i);t.VisitByEncounterTypeComponent={template:s.default,controller:o.default,selector:"visitbyencountertype",bindings:{config:"<"}}},184:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(){function e(t,n,r){"ngInject";a(this,e),Object.assign(this,{openmrsRest:t,widgetsCommons:n,openmrsTranslate:r})}return e.$inject=["openmrsRest","widgetsCommons","openmrsTranslate"],r(e,[{key:"$onInit",value:function(){var e=this;this.visits=[],this.serverUrl="",this.openmrsRest.setBaseAppPath("/coreapps"),this.openmrsRest.getServerUrl().then(function(t){e.serverUrl=t}),this.openmrsRest.get("visit",{patient:this.config.patientUuid,limit:this.getMaxRecords(),fromStartDate:this.widgetsCommons.maxAgeToDate(this.config.maxAge),v:"custom:(uuid,startDatetime,stopDatetime,encounters:(uuid,encounterDatetime,encounterType:(uuid,display)))"}).then(function(t){e.getVisits(t.results)})}},{key:"getVisits",value:function(e){var t=this;angular.forEach(e,function(e){var n=[];if(t.getCombineEncounterTypes()){var a={startDatetime:e.startDatetime,encounterType:"",uuid:e.uuid};angular.forEach(e.encounters,function(e){-1==n.indexOf(e.encounterType.display)&&(""===a.encounterType?a.encounterType=e.encounterType.display:a.encounterType+=", "+e.encounterType.display,n.push(e.encounterType.display))}),t.visits.push(a)}else angular.forEach(e.encounters,function(a){if(-1==n.indexOf(a.encounterType.display)){var r={startDatetime:"true"===t.config.showEncounterDate?a.encounterDatetime:e.startDatetime};r.encounterType=a.encounterType.display,n.push(a.encounterType.display),t.visits.push(r)}})})}},{key:"getCombineEncounterTypes",value:function(){return"false"!==this.config.combineEncounterTypes}},{key:"getMaxRecords",value:function(){return""==this.config.maxRecords||angular.isUndefined(this.config.maxRecords)?6:this.config.maxRecords}}]),e}();t.default=o},250:function(e,t,n){function a(e){return n(r(e))}function r(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./af":10,"./af.js":10,"./ar":17,"./ar-dz":11,"./ar-dz.js":11,"./ar-kw":12,"./ar-kw.js":12,"./ar-ly":13,"./ar-ly.js":13,"./ar-ma":14,"./ar-ma.js":14,"./ar-sa":15,"./ar-sa.js":15,"./ar-tn":16,"./ar-tn.js":16,"./ar.js":17,"./az":18,"./az.js":18,"./be":19,"./be.js":19,"./bg":20,"./bg.js":20,"./bm":21,"./bm.js":21,"./bn":22,"./bn.js":22,"./bo":23,"./bo.js":23,"./br":24,"./br.js":24,"./bs":25,"./bs.js":25,"./ca":26,"./ca.js":26,"./cs":27,"./cs.js":27,"./cv":28,"./cv.js":28,"./cy":29,"./cy.js":29,"./da":30,"./da.js":30,"./de":33,"./de-at":31,"./de-at.js":31,"./de-ch":32,"./de-ch.js":32,"./de.js":33,"./dv":34,"./dv.js":34,"./el":35,"./el.js":35,"./en-SG":36,"./en-SG.js":36,"./en-au":37,"./en-au.js":37,"./en-ca":38,"./en-ca.js":38,"./en-gb":39,"./en-gb.js":39,"./en-ie":40,"./en-ie.js":40,"./en-il":41,"./en-il.js":41,"./en-nz":42,"./en-nz.js":42,"./eo":43,"./eo.js":43,"./es":46,"./es-do":44,"./es-do.js":44,"./es-us":45,"./es-us.js":45,"./es.js":46,"./et":47,"./et.js":47,"./eu":48,"./eu.js":48,"./fa":49,"./fa.js":49,"./fi":50,"./fi.js":50,"./fo":51,"./fo.js":51,"./fr":54,"./fr-ca":52,"./fr-ca.js":52,"./fr-ch":53,"./fr-ch.js":53,"./fr.js":54,"./fy":55,"./fy.js":55,"./ga":56,"./ga.js":56,"./gd":57,"./gd.js":57,"./gl":58,"./gl.js":58,"./gom-latn":59,"./gom-latn.js":59,"./gu":60,"./gu.js":60,"./he":61,"./he.js":61,"./hi":62,"./hi.js":62,"./hr":63,"./hr.js":63,"./hu":64,"./hu.js":64,"./hy-am":65,"./hy-am.js":65,"./id":66,"./id.js":66,"./is":67,"./is.js":67,"./it":69,"./it-ch":68,"./it-ch.js":68,"./it.js":69,"./ja":70,"./ja.js":70,"./jv":71,"./jv.js":71,"./ka":72,"./ka.js":72,"./kk":73,"./kk.js":73,"./km":74,"./km.js":74,"./kn":75,"./kn.js":75,"./ko":76,"./ko.js":76,"./ku":77,"./ku.js":77,"./ky":78,"./ky.js":78,"./lb":79,"./lb.js":79,"./lo":80,"./lo.js":80,"./lt":81,"./lt.js":81,"./lv":82,"./lv.js":82,"./me":83,"./me.js":83,"./mi":84,"./mi.js":84,"./mk":85,"./mk.js":85,"./ml":86,"./ml.js":86,"./mn":87,"./mn.js":87,"./mr":88,"./mr.js":88,"./ms":90,"./ms-my":89,"./ms-my.js":89,"./ms.js":90,"./mt":91,"./mt.js":91,"./my":92,"./my.js":92,"./nb":93,"./nb.js":93,"./ne":94,"./ne.js":94,"./nl":96,"./nl-be":95,"./nl-be.js":95,"./nl.js":96,"./nn":97,"./nn.js":97,"./pa-in":98,"./pa-in.js":98,"./pl":99,"./pl.js":99,"./pt":101,"./pt-br":100,"./pt-br.js":100,"./pt.js":101,"./ro":102,"./ro.js":102,"./ru":103,"./ru.js":103,"./sd":104,"./sd.js":104,"./se":105,"./se.js":105,"./si":106,"./si.js":106,"./sk":107,"./sk.js":107,"./sl":108,"./sl.js":108,"./sq":109,"./sq.js":109,"./sr":111,"./sr-cyrl":110,"./sr-cyrl.js":110,"./sr.js":111,"./ss":112,"./ss.js":112,"./sv":113,"./sv.js":113,"./sw":114,"./sw.js":114,"./ta":115,"./ta.js":115,"./te":116,"./te.js":116,"./tet":117,"./tet.js":117,"./tg":118,"./tg.js":118,"./th":119,"./th.js":119,"./tl-ph":120,"./tl-ph.js":120,"./tlh":121,"./tlh.js":121,"./tr":122,"./tr.js":122,"./tzl":123,"./tzl.js":123,"./tzm":125,"./tzm-latn":124,"./tzm-latn.js":124,"./tzm.js":125,"./ug-cn":126,"./ug-cn.js":126,"./uk":127,"./uk.js":127,"./ur":128,"./ur.js":128,"./uz":130,"./uz-latn":129,"./uz-latn.js":129,"./uz.js":130,"./vi":131,"./vi.js":131,"./x-pseudo":132,"./x-pseudo.js":132,"./yo":133,"./yo.js":133,"./zh-cn":134,"./zh-cn.js":134,"./zh-hk":135,"./zh-hk.js":135,"./zh-tw":136,"./zh-tw.js":136};a.keys=function(){return Object.keys(o)},a.resolve=r,e.exports=a,a.id=250},251:function(e,t){e.exports="<ul>\n    <li ng-if=\"$ctrl.appointments.length != 0\" ng-repeat=\"appointment in $ctrl.appointments track by $index\">\n      <div >{{$ctrl.widgetsCommons.formatDate(appointment.date,$ctrl.config.JSDateFormat,$ctrl.config.language)}}   {{appointment.startTime | date:'h:mm a'}} - {{appointment.endTime | date:'h:mm a'}} {{appointment.ServiceType  | translate }}</div>\n    </li>\n    <p ng-if=\"$ctrl.appointments.length == 0\">\n      {{'coreapps.none' | translate }}\n    </p>\n</ul>"},252:function(e,t){e.exports='<div ng-if="$ctrl.dataViolations.length != 0">\n    <ul>\n        <li ng-repeat="dataViolation in $ctrl.dataViolations">\n            <div style="margin: 5px">\n                <div class="tag" ng-if="dataViolation.actionUrl">\n                    <a style="color: white" href="{{$ctrl.serverUrl}}/{{dataViolation.actionUrl}}">\n                        <strong>\n                            Fix\n                        </strong>\n                    </a>\n                </div>\n                <div>\n                    {{ dataViolation.notes ? dataViolation.notes : dataViolation.rule.ruleName}}\n                </div>\n            </div>\n        </li>\n    </ul>\n</div>\n<div ng-if="$ctrl.dataViolations.length == 0">\n    None\n</div>'},253:function(e,t){e.exports='<div class="input-group date">\n    \x3c!-- TODO: make whether or not form-control-sm class is applied to the input configurable --\x3e\n    <input type="text" class="form-control form-control-sm" readonly="readonly">\n    <div class="input-group-addon">\n        <span class="icon-calendar"></span>\n    </div>\n</div>\n'},254:function(e,t){e.exports='<ul>\n    <li ng-repeat="obs in $ctrl.obs">\n        <div style="display: block; overflow: hidden; padding-right: 5px; padding-bottom: 2px">\n            <span style="float: left">\n                {{obs.conceptName}}:&nbsp;\n            </span>\n            <div ng-if="obs.groupMembers != null && obs.groupMembers.length > 0">\n                <span ng-repeat="member in obs.groupMembers" style="float: left">\n                    {{member.prefix}}&nbsp;<strong>{{member.value}}</strong>\n                    <span ng-if="$index != (obs.groupMembers.length - 1)">&comma;</span>\n                </span> \n            </div>\n            <span ng-else style="float: left">\n                <strong>{{obs.value}}</strong>\n            </span>\n            <span style="float: right; font-size: small; color: #939393">\n                {{obs.obsDaysAgo}}\n            </span>\n        </div>\n    </li>\n\n     <p ng-show="$ctrl.obs.length == 0">\n         <span ng-if="$ctrl.maxAgeInDays != null">\n             {{ \'coreapps.none.inLastTime\' | translate }}  {{$ctrl.maxAgeInDays}}  {{ \'coreapps.days\' | translate }}\n         </span>\n         <span ng-else>\n             {{ \'coreapps.none\' | translate }}\n         </span>\n    </p>\n</ul>'},255:function(e,t){e.exports='<style>\n    #obsTable {\n        table-layout: auto;\n        display: block;\n        overflow-x: auto;\n    }\n\n    .column-header {\n        text-align: center;\n        font-size: small;\n        word-wrap: break-word;\n    }\n\n    .retiredConcept {\n        color: gray;\n        font-style: italic;\n    }\n\n    ::-webkit-scrollbar {\n        -webkit-appearance: none;\n        height: 5px;\n    }\n\n    ::-webkit-scrollbar-thumb {\n        border-radius: 4px;\n        background-color: rgba(0, 0, 0, .5);\n        -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);\n    }\n\n</style>\n\n<table id="obsTable" ng-if="$ctrl.simpleEncs.length != 0">\n    <thead>\n        <tr ng-if="$ctrl.output.headers.length != 0">\n            <th ng-repeat="column in $ctrl.output.headers track by $index" class="column-header">{{ column | translate }}</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr ng-repeat="row in $ctrl.output.rows">\n            <td ng-repeat="cell in row" ng-class="cell.className">\n                <span ng-if="!$ctrl.isArray(cell)">\n                    {{ cell.translate ? (cell.value | translate) : cell.value }}\n                </span>\n                <span ng-if="$ctrl.isArray(cell)" ng-repeat="cellElem in cell">\n                    <span ng-class="cellElem.className">{{ cellElem.translate ? (cellElem.value | translate) : cellElem.value }}{{ $last ? \'\' : \',&nbsp;\' }}</span>\n                </span>\n            </td>\n        </tr>\n    </tbody>\n</table>\n\n<p ng-show="$ctrl.output.encs.length == 0">\n         <span ng-if="$ctrl.output.maxAgeInDays != null">\n             {{ \'coreapps.none.inLastTime\' | translate }}  {{$ctrl.output.maxAgeInDays}}  {{ \'coreapps.days\' | translate }}\n         </span>\n    <span ng-else>\n             {{ \'coreapps.none\' | translate }}\n         </span>\n</p>\n'},256:function(e,t){e.exports='<div ng-if="$ctrl.data.length > 0" >\n    <canvas class="chart chart-line" chart-data="$ctrl.data" chart-labels="$ctrl.labels"\n            chart-series="$ctrl.series" chart-options="$ctrl.options"></canvas>\n</div>\n<div ng-show="$ctrl.data.length == 0">\n    <div style="padding-bottom: 10px; word-break: break-word;">\n        <strong>\n            {{$ctrl.series.join(", ")}}\n        </strong>\n    </div>\n    <span>\n    {{ \'coreapps.none.inLastTime\' | translate }}  {{$ctrl.maxAgeInDays}}  {{ \'coreapps.days\' | translate }}\n    </span>\n</div>\n'},257:function(e,t){e.exports='\x3c!-- NOTE: work-in-progress, consider this not yet an "official" release of this widgets, future changes may not be backwards-compatible and change functionality signficantly --\x3e\n\n\x3c!-- TODO move styles to separate file? --\x3e\n\n<style>\n    #cancel-button {\n        padding: 2px 5px;\n        margin: 5px;\n        font-size: 0.8em;;\n    }\n\n    #enroll-button {\n        padding: 2px 5px;\n        margin: 5px;\n        font-size: 0.8em;;\n    }\n</style>\n<ul>\n    <li ng-show="$ctrl.patientPrograms.length != 0" ng-repeat="patientProgram in $ctrl.patientPrograms | orderBy: \'-dateEnrolled\'">\n        \x3c!-- href="#" included so bootstrap will style this as a link --\x3e\n        <a href="#" ng-click="$ctrl.gotoProgramDashboard($event, patientProgram.program.uuid)">\n            {{ patientProgram.program.display }}\n        </a>\n\n        <div ng-show="!patientProgram.dateCompleted" class="tag">{{ $ctrl.widgetsCommons.formatDate(patientProgram.dateEnrolled,$ctrl.config.JSDateFormat,$ctrl.config.language) }} - {{\'coreapps.dashboardwidgets.programs.current\' | translate }}</div>\n        <div ng-show="patientProgram.dateCompleted" class="tag">{{ $ctrl.widgetsCommons.formatDate(patientProgram.dateEnrolled,$ctrl.config.JSDateFormat,$ctrl.config.language) }} - {{ $ctrl.widgetsCommons.formatDate(patientProgram.dateCompleted,$ctrl.config.JSDateFormat,$ctrl.config.language) }}</div>\n    </li>\n\n    <li ng-show="$ctrl.patientPrograms.length == 0">\n        {{\'coreapps.none\' | translate }}\n    </li>\n\n</ul>\n\n\n<div ng-show="$ctrl.canEnrollInProgram && !$ctrl.showAddProgram && $ctrl.config.enableProgramDashboards && $ctrl.unenrolledPrograms && $ctrl.unenrolledPrograms.length > 0">\n    <a class="add-link" ng-click="$ctrl.addProgram()">\n        <i class="icon-plus-sign" title="{{\'coreapps.dashboardwidgets.programs.addProgram\' | translate }}"/>\n    </a>\n</div>\n\n<div ng-show="$ctrl.showAddProgram">\n    <div>\n        <select  ng-model="$ctrl.input.program"\n                 ng-options="program.uuid as program.display for program in $ctrl.unenrolledPrograms">\n            <option value="">{{\'coreapps.dashboardwidgets.programs.selectProgram\' | translate }}:</option>\n        </select>\n        <br/>\n    </div>\n    <div>\n        <button id="enroll-button" class="confirm" ng-click="$ctrl.gotoProgramDashboard($event)">{{\'coreapps.enroll\' | translate }}</button>\n        <button id="cancel-button" class="cancel" ng-click="$ctrl.cancelAddProgram()">{{\'coreapps.cancel\' | translate }}</button>\n    </div>\n</div>\n'},258:function(e,t){e.exports="<ul>\n    <li>{{'coreapps.dashboardwidgets.programstatistics.currentlyEnrolled' | translate }}: {{  $ctrl.currentlyEnrolled != null ? $ctrl.currentlyEnrolled : 'coreapps.dashboardwidgets.programstatistics.loading' | translate }}</li>\n    <li>{{'coreapps.dashboardwidgets.programstatistics.everEnrolled' | translate }}: {{  $ctrl.everEnrolled != null ? $ctrl.everEnrolled : 'coreapps.dashboardwidgets.programstatistics.loading' | translate }}</li>\n</ul>"},259:function(e,t){e.exports='\x3c!-- TODO: move css to separate file? the the "workflow-header" is a super hack, should be fixed by someone who understands css bettter --\x3e\n\x3c!-- input-group-addon is to fix alignment of calendar icons on date pickers --\x3e\n\n<style>\n\n    .input-group-addon {\n        display: inline-block;;\n    }\n\n    input {\n        width: 80%\n    }\n\n    .programstatus-fieldset, .programstatus-field {\n        padding-top: 2px;\n        padding-bottom: 2px;\n    }\n\n    .workflow-section {\n        padding-top: 5px;\n    }\n\n    .workflow-table {\n        border: none !important;\n        font-size: 0.8em !important;\n        background: #f9f9f9 !important;\n    }\n\n    .workflow-header  {\n        width: 100% !important;\n        text-align: left !important;\n    }\n\n    .workflow-cell {\n        border: none !important;\n        font-size: 0.8em !important;\n    }\n\n    .hidden {\n        visibility: hidden;\n    }\n\n    .center {\n        margin-left: 0px;\n        margin-right: 0px;\n        text-align: center;\n    }\n\n    .bold {\n        font-weight: bold;\n    }\n\n</style>\n\n<div ng-show="$ctrl.deleted">\n    {{ \'coreapps.dashboardwidgets.programstatus.programDeleted\' | translate }}\n</div>\n\n<div ng-show="$ctrl.loaded && !$ctrl.deleted">\n    <div ng-show="$ctrl.canEnrollInProgram && !$ctrl.patientProgram && $ctrl.expanded.enrollment">\n        <fieldset class="programstatus-fieldset">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.enrollmentdate\' | translate }}</h3>\n\t\t\t<p class="programstatus-field">\n                <openmrs-datepicker ng-model="$ctrl.input.dateEnrolled"\n                                    format="{{$ctrl.dateFormat}}"\n                                    start-date="$ctrl.minEnrollmentDate"\n                                    end-date="$ctrl.today"/>\n            </p>\n        </fieldset>\n        <fieldset class="programstatus-fieldset">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.enrollmentlocation\' | translate }}</h3>\n            <p class="programstatus-field">\n                <select class="form-control form-control-sm"\n                        ng-model="$ctrl.input.enrollmentLocation"\n                        ng-options="location.uuid as location.display for location in $ctrl.programLocations">\n                </select>\n            </p>\n        </fieldset>\n        <div ng-repeat="workflow in $ctrl.program.workflows track by $index" ng-show="$ctrl.program.workflows.length != 0">\n            <fieldset class="programstatus-fieldset">\n                <h3>{{ workflow.concept.display }}</h3>\n                <p class="programstatus-field">\n                    <select class="form-control form-control-sm" ng-model="$ctrl.input.initialWorkflowStateByWorkflow[workflow.uuid].state"\n                            ng-options="state.uuid as state.concept.display for state in $ctrl.statesByWorkflow[workflow.uuid] | filter: $ctrl.isInitialState() | orderBy: \'concept.display\' ">\n                        <option value=""></option>\n                    </select>\n                </p>\n            </fieldset>\n        </div>\n        <div class="center">\n            <button class="confirm" ng-disabled="!$ctrl.enrollmentValid()" ng-click="$ctrl.enrollInProgram()">{{\'coreapps.enroll\' | translate }}</button>\n            <button class="cancel" ng-click="$ctrl.cancelEnrollment()">{{\'coreapps.cancel\' | translate }}</button>\n        </div>\n    </div>\n\n    <div ng-show="$ctrl.canEnrollInProgram && !$ctrl.patientProgram && !$ctrl.expanded.enrollment">\n        <div class="center">\n            {{ \'coreapps.dashboardwidgets.programstatus.notCurrentlyEnrolled\' | translate }}\n        </div>\n        <div class="center">\n            <button class="confirm" ng-click="$ctrl.expanded.enrollment = true">{{\'coreapps.enroll\' | translate }}</button>\n        </div>\n    </div>\n\n    <div ng-show="$ctrl.patientProgram">\n\n        \x3c!-- VIEW sections --\x3e\n\n        <fieldset  class="programstatus-fieldset" ng-show="!$ctrl.edit.enrollment">\n            <i ng-show="$ctrl.canDeleteProgram && !$ctrl.inEditMode() && !$ctrl.inConfirmDelete()" ng-click="$ctrl.deletePatientProgram()" class="icon-remove right"/>\n            <i ng-show="$ctrl.canEditProgram && !$ctrl.inEditMode() && !$ctrl.inConfirmDelete()" ng-click="$ctrl.toggleEditEnrollment()" class="icon-pencil right"/>\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.enrolled\' | translate }}</h3>\n            <p class="programstatus-field">{{ $ctrl.widgetsCommons.formatDate($ctrl.patientProgram.dateEnrolled,$ctrl.config.JSDateFormat,$ctrl.config.language) }}</p>\n        </fieldset>\n\n        <fieldset class="programstatus-fieldset"  ng-show="!$ctrl.edit.enrollment">\n            <h3>{{\'coreapps.location\' | translate }}</h3>\n            <p class="programstatus-field">{{ $ctrl.patientProgram.location.display }}</p>\n        </fieldset>\n\n        <fieldset class="programstatus-fieldset" ng-show="!$ctrl.edit.enrollment && $ctrl.programIsCompleted()">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.completed\' | translate }}</h3>\n            <p class="programstatus-field">{{ $ctrl.widgetsCommons.formatDate($ctrl.patientProgram.dateCompleted,$ctrl.config.JSDateFormat,$ctrl.config.language) }}</p>\n        </fieldset>\n\n        <fieldset class="programstatus-fieldset" ng-show="$ctrl.programOutcomes && !$ctrl.edit.enrollment && $ctrl.programIsCompleted()">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.outcome\' | translate }}</h3>\n            <p class="programstatus-field">{{ $ctrl.patientProgram.outcome.display }}</p>\n        </fieldset>\n\n        \x3c!-- EDIT sections --\x3e\n        <fieldset class="programstatus-fieldset" ng-show="$ctrl.edit.enrollment">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.enrolled\' | translate }}</h3>\n            <p class="programstatus-field">\n                <openmrs-datepicker ng-model="$ctrl.input.dateEnrolled"\n                                    format="{{$ctrl.dateFormat}}"\n                                    start-date="$ctrl.minEnrollmentDate"\n                                    end-date="$ctrl.input.dateCompleted ? $ctrl.input.dateCompleted : $ctrl.today"\n                                    language="{{$ctrl.language}}"/>\n            </p>\n        </fieldset>\n\n        <fieldset class="programstatus-fieldset" ng-show="$ctrl.edit.enrollment">\n            <h3>{{\'coreapps.location\' | translate }}</h3>\n            <p class="programstatus-field">\n                <select class="form-control form-control-sm" ng-model="$ctrl.input.enrollmentLocation"\n                    ng-options="location.uuid as location.display for location in $ctrl.programLocations">\n                </select>\n            </p>\n        </fieldset>\n\n        <fieldset class="programstatus-fieldset" ng-show="$ctrl.edit.enrollment">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.completed\' | translate }}:</h3>\n            <p class="programstatus-field">\n                <openmrs-datepicker ng-model="$ctrl.input.dateCompleted"\n                                format="{{$ctrl.dateFormat}}"\n                                start-date="$ctrl.getMostRecentStateChangeDate() ? $ctrl.getMostRecentStateChangeDate() : $ctrl.input.dateEnrolled"\n                                end-date="$ctrl.maxCompletionDate ? $ctrl.maxCompletionDate : $ctrl.today"\n                                clear-btn="true"\n                                language="{{$ctrl.language}}"/>\n            </p>\n        </fieldset>\n\n        <fieldset class="programstatus-fieldset" ng-show="$ctrl.programOutcomes && $ctrl.edit.enrollment">\n            <h3>{{\'coreapps.dashboardwidgets.programstatus.outcome\' | translate }}:</h3>\n            <p class="programstatus-field">\n                <select class="form-control form-control-sm" ng-model="$ctrl.input.outcome"\n                    ng-options="outcome.uuid as outcome.display for outcome in $ctrl.programOutcomes | orderBy: \'display\' ">\n                    <option value=""></option>\n                </select>\n            </p>\n        </fieldset>\n\n        <div ng-show="$ctrl.edit.enrollment" class="center">\n            <button class="confirm" ng-disabled="!$ctrl.enrollmentValid()" ng-click="$ctrl.update()">{{\'coreapps.save\' | translate }}</button>  <button class="cancel" ng-click="$ctrl.cancelEdit()">{{\'coreapps.cancel\' | translate }}</button>\n        </div>\n\n        \x3c!-- DELETE confirmation section --\x3e\n\n        <div ng-show="$ctrl.confirmDelete.enrollment" class="center">\n            {{\'coreapps.dashboardwidgets.programstatus.confirmDelete\' | translate }}\n            <br/><br/>\n            <button class="confirm" ng-click="$ctrl.deletePatientProgram()">{{\'coreapps.delete\' | translate }}</button>  <button class="cancel" ng-click="$ctrl.cancelDelete()">{{\'coreapps.cancel\' | translate }}</button>\n        </div>\n\n        \x3c!-- workflow sections --\x3e\n\n        <div class="workflow-section" ng-repeat="workflow in $ctrl.program.workflows track by $index" ng-show="$ctrl.program.workflows.length != 0">\n            \x3c!-- TODO review the use of the "isToday" functionality --\x3e\n            <h3 class="workflow-header">{{ workflow.concept.display }}\n                <i ng-show="$ctrl.canEditProgram && !$ctrl.inEditMode() && !$ctrl.inConfirmDelete() && !$ctrl.isToday($ctrl.sortedStatesByWorkflow[workflow.uuid].startDate)" ng-click="$ctrl.toggleEditWorkflow(workflow.uuid)" class="icon-pencil"/>\n            </h3>\n\n            <fieldset class="programstatus-fieldset" ng-show="$ctrl.edit.workflow[workflow.uuid]">\n                <h3>{{\'coreapps.dashboardwidgets.programstatus.transitionTo\' | translate }}</h3>\n                <p class="programstatus-field">\n                    <select class="form-control form-control-sm" ng-model="$ctrl.input.changeToStateByWorkflow[workflow.uuid].state"\n                            ng-options="state.uuid as state.concept.display for state in $ctrl.statesByWorkflow[workflow.uuid] | filter: $ctrl.isNotCurrentState(workflow) | orderBy: \'concept.display\' ">\n                        <option value=""></option>\n                    </select>\n                </p>\n            </fieldset>\n\n            <fieldset class="programstatus-fieldset" ng-show="$ctrl.edit.workflow[workflow.uuid]">\n                <h3>{{\'coreapps.on\' | translate }}</h3>\n                <p class="programstatus-field">\n                    <openmrs-datepicker ng-model="$ctrl.input.changeToStateByWorkflow[workflow.uuid].date"\n                                        format="{{$ctrl.dateFormat}}"\n                                        start-date="$ctrl.sortedStatesByWorkflow[workflow.uuid] ? $ctrl.sortedStatesByWorkflow[workflow.uuid][0].dayAfterStartDate : $ctrl.input.dateEnrolled"\n                                        end-date="$ctrl.programIsCompleted() ? $ctrl.patientProgram.dateCompleted : $ctrl.today"\n                                        language="{{$ctrl.language}}"/>\n                </p>\n            </fieldset>\n\n            <div ng-show="$ctrl.edit.workflow[workflow.uuid]" class="center">\n                <button class="confirm" ng-disabled="!$ctrl.workflowTransitionValid(workflow.uuid)" ng-click="$ctrl.updatePatientState(workflow.uuid)">{{\'coreapps.save\' | translate }}</button>  <button class="cancel" ng-click="$ctrl.toggleEditWorkflow(workflow.uuid)">{{\'coreapps.cancel\' | translate }}</button>\n            </div>\n\n            <table class="workflow-table">\n                <tr ng-repeat="row in $ctrl.sortedStatesByWorkflow[workflow.uuid]" ng-show="$first || $ctrl.expanded.workflow[workflow.uuid]">\n                    <td class="workflow-cell">\n                        {{ row.startDate | date:$ctrl.dateFormat }}\n                        <span ng-show="!$first">{{\'coreapps.to\' | translate}} {{ row.endDate | date:$ctrl.dateFormat }} </span>\n                    </td>\n                    <td class="workflow-cell" ng-class="{bold:$first}">\n                        {{ row.state.concept.display }}\n                    </td>\n                    <td class="workflow-cell">\n                        <i ng-show="$first && $ctrl.canEditProgram  && !$ctrl.inEditMode() && !$ctrl.inConfirmDelete()" class="icon-remove right" ng-click="$ctrl.deleteMostRecentPatientState(workflow.uuid)"/>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="workflow-cell" colspan="4" ng-show="!$ctrl.expanded.workflow[workflow.uuid] && $ctrl.sortedStatesByWorkflow[workflow.uuid] && $ctrl.sortedStatesByWorkflow[workflow.uuid].length > 1">\n                        <a ng-click="$ctrl.toggleExpandedWorkflow(workflow.uuid)">{{ \'coreapps.showMore\' | translate }}</a>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="workflow-cell" colspan="4" ng-show="$ctrl.expanded.workflow[workflow.uuid] && $ctrl.sortedStatesByWorkflow[workflow.uuid] && $ctrl.sortedStatesByWorkflow[workflow.uuid].length > 1">\n                        <a ng-click="$ctrl.toggleExpandedWorkflow(workflow.uuid)">{{ \'coreapps.showLess\' | translate }}</a>\n                    </td>\n                </tr>\n            </table>\n\n            \x3c!-- DELETE  workflow confirmation section --\x3e\n\n            <div ng-show="$ctrl.confirmDelete.workflow[workflow.uuid]" class="center">\n                {{\'coreapps.dashboardwidgets.programstatus.confirmWorkflowStateDelete\' | translate }}\n                <br/><br/>\n                <button class="confirm" ng-click="$ctrl.deleteMostRecentPatientState(workflow.uuid)">{{\'coreapps.delete\' | translate }}</button>  <button class="cancel" ng-click="$ctrl.cancelDelete()">{{\'coreapps.cancel\' | translate }}</button>\n            </div>\n\n        </div>\n\n\n\n    </div>\n\n</div>\n'},260:function(e,t){e.exports='<ul>\n    <li class="relationship-li" ng-show="$ctrl.relationships.length != 0" ng-repeat="relationship in $ctrl.relationships track by $index">\n        <div class="relationship-wrapper">\n            <div class="fifty-percent relationship-inner">\n                <span>\n                    <a ng-show="relationship.isPatient || relationship.isProvider" ng-click="$ctrl.goTo(relationship.toPerson.uuid)">\n                        {{relationship.toPerson.display ? relationship.toPerson.display : relationship.toPerson.personName.display}}\n                    </a>\n                    <span ng-show="!relationship.isPatient && !relationship.isProvider">{{relationship.toPerson.display ? relationship.toPerson.display : relationship.toPerson.personName.display}}</span>\n                </span>\n            </div>\n            <div class="tag forty-percent relationship-inner">\n                <span ng-show="$ctrl.hasEditPrivileges == true && $ctrl.removeFlag == false && $ctrl.edit == false" class="remove-tag">\n                    <a ng-show="relationship.isPatient" class="remove-link" ng-click="$ctrl.removeRelationship(relationship.uuid)">\n                        <i class="icon-remove" title="Remove relationship"></i>\n                    </a>\n                </span>\n                {{ relationship.type | translate }}\n            </div>\n        </div>\n    </li>\n    <p ng-show="$ctrl.relationships.length == 0">\n        {{ \'coreapps.none\' | translate }}\n    </p>\n\n    <li ng-show="$ctrl.removeFlag">\n        {{ \'coreapps.dashboardwidgets.relationships.confirmRemove\' | translate }}\n    </li>\n\n    <li ng-show="$ctrl.hasEditPrivileges && !$ctrl.edit && !$ctrl.removeFlag">\n        <a class="add-link" ng-click="$ctrl.addRelationship()">\n            <i class="icon-plus-sign" title="Add relationship"></i>\n        </a>\n    </li>\n\n    <li ng-show="$ctrl.edit">\n        {{ \'coreapps.dashboardwidgets.relationships.add\' | translate }}\n    </li>\n\n    <li ng-show="$ctrl.edit">\n        <p class="left">\n        <select class="relationship-input" ng-options="type.name | translate for type in $ctrl.types"\n                ng-model="$ctrl.relationshipType" ng-change="$ctrl.updateRelationshipType()">\n            <option value="">{{ \'coreapps.dashboardwidgets.relationships.whatType\' | translate }}</option>\n        </select>\n\n        </p>\n    </li>\n    <li ng-show="$ctrl.showFindOtherPerson">\n        &nbsp;\n    </li>\n    <li ng-show="$ctrl.showFindOtherPerson">\n        <p class="left">\n            <input type="text" class="person-typeahead relationship-input" placeholder="{{ \'coreapps.relationships.find\' | translate }} {{ $ctrl.relationshipType.name | translate}}"\n                   ng-model="$ctrl.searchPerson"\n                   typeahead-no-results="noResults"\n                   ng-change="$ctrl.searchPersons()"\n                   uib-typeahead="person as person.display + \' (\' + person.gender + \', \' + (person.age ? person.age:\'\') + \')\' for person in $ctrl.relatedPersons"\n                   typeahead-wait-ms="250"\n                   typeahead-select-on-exact="true"\n                   typeahead-min-length="3"\n                   typeahead-on-select="$ctrl.onSelect($item, $model, $label)"\n                   />\n        </p>\n    </li>\n\n    <li ng-show="$ctrl.edit">\n        <p>\n        <div>\n            <button class="tag" ng-show="$ctrl.showSaveButton" ng-click="$ctrl.save()">{{ \'coreapps.save\' | translate }}</button>\n            <button class="cancel-tag" ng-click="$ctrl.cancel()">{{ \'coreapps.cancel\' | translate }}</button>\n        </div>\n        </p>\n    </li>\n\n    <li ng-show="$ctrl.removeFlag">\n        <p>\n        <div>\n            <button class="tag" ng-click="$ctrl.remove()">{{ \'coreapps.delete\' | translate }}</button>\n            <button class="cancel-tag" ng-click="$ctrl.cancel()">{{ \'coreapps.cancel\' | translate }}</button>\n        </div>\n        </p>\n    </li>\n\n</ul>'},261:function(e,t){e.exports='<ul>\n    <li ng-if="$ctrl.visits.length != 0" ng-repeat="visit in $ctrl.visits track by $index">\n        <a href="{{$ctrl.serverUrl}}/coreapps/patientdashboard/patientDashboard.page?patientId={{$ctrl.config.patientUuid}}&visitId={{visit.uuid}}">\n            {{$ctrl.widgetsCommons.formatDate(visit.startDatetime,$ctrl.config.JSDateFormat,$ctrl.config.language)}}\n        </a>\n        <div class="tag" ng-if="visit.encounterType !== \'\'">{{visit.encounterType | translate }}</div>\n    </li>\n    <p ng-if="$ctrl.visits.length == 0">\n        {{ \'coreapps.none\' | translate }}\n    </p>\n</ul>'},4:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=a(r),i=n(161),s=a(i),l=o.default.module("dashboardwidgets.services",[]);l.service("widgetsCommons",s.default),t.default=l.name}},[168])});
//# sourceMappingURL=coreapps.dashboardwidgets.js.map